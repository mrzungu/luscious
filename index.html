<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Luscious RSVP</title>
  <meta name="description" content="Simple booking form with Yoco payment and Google Sheets storage." />
  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#3b82f6; }
    * { box-sizing: border-box; }
    body {
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
      background: linear-gradient(135deg, #0f172a, #111827);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color: var(--text);
      padding: 24px;
    }
    .card {
      width: 100%; max-width: 520px; background: rgba(17,24,39,0.9);
      .my-box {
  -webkit-backdrop-filter: blur(10px); /* Safari/iOS support */
  backdrop-filter: blur(10px);         /* Other browsers */};
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 18px; padding: 22px;
      box-shadow: 0 12px 32px rgba(0,0,0,0.35);
    }
    h1 { margin: 0 0 12px; font-size: 1.5rem; }
    p.sub { margin-top:0; margin-bottom:18px; color: var(--muted); font-size: 0.95rem; }
    label { display:block; margin-top:12px; font-weight:600; font-size:0.95rem; }
    input, select {
      width:100%; margin-top:6px; padding:12px 14px; border-radius:12px; border:1px solid #334155;
      background:#0b1220; color:var(--text); outline:none;
    }
    input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59,130,246,0.25); }
    button {
      width:100%; margin-top:18px; padding:12px 16px; border:none; border-radius:12px;
      background: var(--accent); color:white; font-weight:700; cursor:pointer; font-size:1rem;
    }
    button:hover { filter: brightness(1.05); }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .note { font-size: 0.85rem; color:#9ca3af; margin-top:10px; }
    .footer { margin-top: 12px; text-align:center; font-size:0.85rem; color:#94a3b8; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Luscious Exclusive Gala Booking Form</h1>
    <p class="sub">Fill your details, choose ticket type, then click Submit & Pay to complete your booking</p>
    <form id="bookingForm" autocomplete="on">
      <label for="name">Full Name</label>
      <input type="text" id="name" name="name" placeholder="Jane Doe" required />

      <label for="email">Email</label>
      <input type="email" id="email" name="email" placeholder="jane@example.com" required />

      <label for="phone">Phone Number</label>
      <input type="tel" id="phone" name="phone" placeholder="0812345678" required />

      <div class="row">
        <div>
          <label for="date">Booking Date</label>
          <input type="date" id="date" name="date" required />
        </div>
        <div>
          <label for="service">Select Ticket Type</label>
          <select id="service" name="service" required>
            <option value="">Choose…</option>
            <option value="General">General Admission</option>
            <option value="V.I.P">V.I.P Experience</option>
          </select>
        </div>
      </div>

      <label for="ticket">Ticket Type</label>
      <select id="ticket" name="ticket" required>
        <option value="">Choose…</option>
        <option value="general">General</option>
        <option value="vip">VIP</option>
      </select>

      <button type="submit" id="submitBtn">Submit & Pay</button>
      <p class="note">After submitting, a Yoco checkout opens in a new tab. This page will show your QR ticket.</p>
    </form>
    <div class="footer">Powered by GitHub Pages · Google Sheets · Yoco</div>
  </div>

  <script>
    // TODO: Replace these 3 values before going live
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz05dy4oCRQv9rCeoP8G9ToAVt0vxpxQc5rkaVMFRPnr3bbAN8-yG32WAqLmZqYl2Nr/exec";
    const YOCO_GENERAL = "https://pay.yoco.com/r/4qjw9G";
    const YOCO_VIP = "https://pay.yoco.com/r/mzjMwK";

    const form = document.getElementById("bookingForm");
    const submitBtn = document.getElementById("submitBtn");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      submitBtn.disabled = true;
      submitBtn.textContent = "Saving…";

      const payload = {
        name: document.getElementById("name").value.trim(),
        email: document.getElementById("email").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        date: document.getElementById("date").value,
        service: document.getElementById("service").value,
        ticket: document.getElementById("ticket").value
      };

      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const text = await res.text(); // expecting the ticket/uuid string
        const ticketId = text.replace(/\n/g, '').trim();
        if (!ticketId) throw new Error("No ticket ID returned");

        // Save ticket locally so ticket.html can load the QR
        localStorage.setItem("ticketID", ticketId);
        localStorage.setItem("bookingName", payload.name);
        localStorage.setItem("bookingEmail", payload.email);
        localStorage.setItem("bookingTicket", payload.ticket);

        // Open Yoco checkout in a new tab
        const link = payload.ticket === "vip" ? YOCO_VIP : YOCO_GENERAL;
        window.open(link, "_blank", "noopener,noreferrer");

        // Navigate to ticket page in the current tab
        window.location.href = "./ticket.html";
      } catch (err) {
        alert("There was a problem saving your booking. Please try again.");
        console.error(err);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit & Pay";
      }
    });
  </script>
</body>
</html>
